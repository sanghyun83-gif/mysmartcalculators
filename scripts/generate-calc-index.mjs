import fs from 'fs';
import path from 'path';

const calculatorsDir = 'lib/calculators';
const outputFile = 'lib/all-calculators.ts';

const files = fs.readdirSync(calculatorsDir).filter(file => file.endsWith('.ts'));

const allCalculators = files.map(file => {
    const id = file.replace('.ts', '');
    const content = fs.readFileSync(path.join(calculatorsDir, file), 'utf-8');

    // Extract SITE.name
    const nameMatch = content.match(/name:\s*["'](.+?)["']/);
    const name = nameMatch ? nameMatch[1] : id;

    // Extract Category from filename or content (simplified mapping for now)
    // In lib/categories.ts, CATEGORY_MAP is already defined.
    // We will just export the IDs and use CATEGORY_MAP at runtime.

    return { id, name };
});

const outputContent = `/**
 * AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
 * Generated by scripts/generate-calc-index.mjs
 */

export interface CalculatorIndexItem {
    id: string;
    name: string;
}

export const ALL_CALCULATORS: CalculatorIndexItem[] = ${JSON.stringify(allCalculators, null, 4)};
`;

fs.writeFileSync(outputFile, outputContent);
console.log(`Generated index for ${allCalculators.length} calculators.`);
